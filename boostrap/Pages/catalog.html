<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('stylecss')}}">

</head>
<body>
          <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid"> <a class="navbar-brand" href="../index.html">Book Catalog</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto mb-2 mb-lg-0">
            </ul>
            <form class="d-flex" onsubmit="search(this)"> <input class="form-control mr-2" type="search" placeholder="Search" aria-label="Search"> <button class="btn btn-outline-success">Search</button> </form>
        </div>
    </div>
    <div class="uk-navbar-right"><a class="uk-navbar-item uk-link-muted tm-navbar-button uk-icon" href="{{url_for('signup')}}" uk-icon="icon: user; ratio:2" id="account"><svg width="40" height="40" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"> <circle fill="none" stroke="white" stroke-width="1.1" cx="9.9" cy="6.4" r="4.4"></circle> <path fill="none" stroke="#fff" stroke-width="1.1" d="M1.5,19 C2.3,14.5 5.8,11.2 10,11.2 C14.2,11.2 17.7,14.6 18.5,19.2"></path></svg></a></div>

</nav>
    <div class="album py-5 bg-light">
        <div class="container">

          <div class="row" id = "blocks">
          </div>
          <nav aria-label="Page navigation example">
            <ul class="pagination" id = 'pages'>
            </ul>
          </nav>
        </div>
      </div>
 <script src = "{{url_for('navbarCretionScript')}}"></script>
<script>
  const getBooks = async () => {
    const row = document.getElementById('blocks');
    const pagination = document.getElementById('pages');

    /*
    json
    {
      pagination: 2,
      books:  [
        {
    "book_title":"",
    "author":"",
    "genre":"",
    "book_id":"",iption":"?",
    }
    ]
    }
    */
   alert("{{url_for('take_books_data')}}");
   await fetch("{{url_for('take_books_data')}}", {method: 'GET'})//вставте необхідну урлу для перевірки респонсу метод гет
	.then(response => {
    if (response.status !== 200) {
          alert(`Looks like there was a problem. Status code: ${response.status}`);
          return;
        }
      console.log(response.status);
    return response.json()})
    .then(data => {
/*
    let i = data.pagination;
    while(i > 0){
      pagination.insertAdjacentHTML("afterbegin",`<li class="page-item"><a class="page-link" onclick = "getPagination(${i})">${i}</a></li>`);
      i-=1;
    }
*/  console.log(data);
    data.books.forEach((book,index) => {
      let div = document.createElement('div');
      div.className = "col-md-4";
      div.innerHTML =  `
    <div class="card mb-4 box-shadow" id = ${'book'+index}>
       <div class="card-body">
          <p class="card-text">${book.book_title}</p>
          <p class="card-text">${book.authors}</p>
          <p class="card-text">${book.year}</p>
            <div class="d-flex justify-content-between align-items-center">
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-primary" >ADD</button>
                <button type="button" class="btn btn-sm btn-outline-secondary">INFO</button>
              </div>
            </div>
        </div>
    </div>
  `;
  const functions = [addBook,getInfo];
    div.querySelectorAll('button').forEach((button,index) => {
      button.addEventListener("click", () => functions[index](button,book));
    });
  //block.find('button').on('click', () => addBook(book));

      row.append(div);
    }).catch(error => alert(error));
});
};

const getInfo = (event, data) =>{
  if(event){
    const card = event.parentNode.parentNode;
  
  event.parentNode.removeChild(event);
 
  card.insertAdjacentHTML('beforebegin', `<p class="card-text">${data.genres}</p>
  <p class="card-text">${data.number_of_available}</p>`);
  }
};

  const search = async (form) => {
    /*const input = document.querySelector('input').value;

    sessionStorage.setItem('input',input);*/
    console.log(form);
    /*
    await fetch("{{url_for('find_by_title')}}", {method: 'POST', body: })//вставте необхідну урлу для перевірки респонсу метод гет
	.then(response => {
    if (response.status !== 200) {
          alert(`Looks like there was a problem. Status code: ${response.status}`);
          return;
        }
      console.log(response.status);
    return response.json()})
    .then(data => {
      console.log();})
      .catch(error => alert('something going wrong'));
      */
  };

const addBook = (event, book) => {
  const field = event.parentNode.parentNode.parentNode.parentNode.id;

  localStorage.setItem(field, JSON.stringify(book));
  /*await fetch('', {
    method: 'POST',
    body: book,
  })//вставте необхідну урлу для перевірки респонсу метод гет
	    .then(response => {
        if (response.status !== 200) {
          alert(`Looks like there was a problem. Status code: ${response.status}`);
          return;
        }

    return response.json()})
    .then(data => {
      alert(data);});*/
};
/*
const getPagination = async (index) => {
  const json = {
    "pageIndex":index,
  };

  try {
		await fetch('', {//вставте необхідну урлу
			method: 'post',
			body: JSON.stringify(json)}
			);
	}
	catch(error){
		alert('Failed sending');
		return;
	}
};
*/
getBooks();
</script>
</body>
</html>